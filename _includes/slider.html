<!-- Responsive slider - START -->
<div class="fluidHeight">
<div class="sliderContainer home">
  <div class = 'iosSlider'>
    <div class = 'slider'>
    </div>

    <a class="slider-control prev" >&lt;</a>
    <a class="slider-control next" >&gt;</a>

    <div class="pages">
    </div>
  </div>
</div>
</div>

<script>
  var stages = {{ site.data.stages | jsonify }};
</script>

<script src="{{ site.baseurl }}/js/jquery.iosslider.min.js"></script>
<script type="text/javascript">
  var baseurl = "{{ site.baseurl }}";
  /**
   * Randomize array element order in-place.
   * Using Fisher-Yates shuffle algorithm.
   */
  function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = array[i];
      array[i] = array[j];
      array[j] = temp;
    }
    return array;
  }

  $(document).ready(function() {
    var doc = $(document);
    var size = (Math.min(doc.width(), doc.height()) <= 768) ?
      '-small' : '';

    var files = [
      [27, "left", "", "", '/images/slide-27', "/actualites/portes_ouvertes"]
      // [9, "left", "L'Annexe", "", '/images/slide-9'],
      // [4, "left", "Partage et convivialité", "Nos valeurs", 'images/slide-4'],
      // [8, "left", "", "", 'images/slide-8'],
      // [3, "left", "Générosité et savoir-faire", "Donner et transmettre notre passion", 'images/slide-3'],
      // [1, "left", "Un cadre chaleureux", "Trois salles", 'images/slide-1'],
      // [2, "left", "Émotion et spontanéité", "Le plaisir avant tout", 'images/slide-2']
    ];

    if (stages) {
      files = stages.map(function(stage, index) {
        return [index, 'left', "", "", 'stage/' + stage.assets + '_slider', 'stage/' + stage.title + '/'];
      });
    }
    // files = shuffleArray(files);
    for (var i = 0; i < files.length; i++) {
      var file = files[i][0];
      var image = $('<img />', {
        src: baseurl + files[i][4] + size + '.jpg'
      });
      var item = $('<div/>', {
        'class': 'item'
      });
      var inner = $('<div/>', {
        'class': 'inner'
      });
      item.append(inner);
      inner.append(image);
      if (files[i][5]) {
        image.css('cursor', 'pointer');
        function onclick(url) {
          window.location = url;
        }
        image.on('click', $.proxy(onclick, null, files[i][5]));
      }

      if (files[i][2]) {
        inner.append($('<div />', {
            "class": "text1 " + files[i][1],
            html: files[i][2]
        }));
      }
      if (files[i][3]) {
        inner.append($('<div />', {
            "class": "text2 " + files[i][1],
            html: files[i][3]
        }));
      }

      $('.iosSlider .slider').append(item);
      $('.iosSlider .pages').append($('<a />', {
        'class': 'page'
      }));
    }

    $('.pages .page').first().addClass('active');

    $('.iosSlider').iosSlider({
      autoSlide: true,
      snapToChildren: true,
      desktopClickDrag: true,
      keyboardControls: true,
      navNextSelector: $('.next'),
      navPrevSelector: $('.prev'),
      navSlideSelector: $('.pages .page'),
      onSlideChange: slideChange,
      infiniteSlider: true,
      autoSlideTimer: 5000,
      onSlideComplete: slideComplete,
      onSliderLoaded: sliderLoaded,
      onSlideChange: slideChange,
      snapSlideCenter: true,
      autoSlideHoverPause: false
    });
    function slideComplete(args) {
      if(!args.slideChanged) return false;
      showText(args);
    }
    function sliderLoaded(args) {
      showText(args);
      slideChange(args);
    }
    function showText(args) {
      $(args.sliderObject).find('.text1, .text2').removeClass('display');
      $(args.currentSlideObject).find('.text1').delay(1600).queue(function(next) {
        $(this).addClass('display');
        next();
      });
      $(args.currentSlideObject).find('.text2').delay(2800).queue(function(next) {
        $(this).addClass('display');
        next();
      });
    }
  });

  function slideChange(args) {
    $('.pages .page').removeClass('active');
    $('.pages .page:eq(' + (args.currentSlideNumber - 1) + ')').addClass('active');
  }
</script>
